<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CMS Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />

  <!-- Dashboard-only styles (so you don't need to touch style.css if you don't want) -->
  <style>
    .dash-wrap { max-width: 1100px; margin: 22px auto 40px; padding: 0 16px; }
    .dash-header { display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
    .dash-title { display:flex; gap:10px; align-items:center; }
    .badge { font-weight:700; font-size:0.78rem; padding:6px 10px; border-radius:999px; border:1px solid var(--cms-border); background:#fff; }
    .badge.ok { border-color:#16a34a; color:#166534; background:#dcfce7; }
    .badge.warn { border-color:#f59e0b; color:#92400e; background:#fef3c7; }
    .badge.bad { border-color:#ef4444; color:#7f1d1d; background:#fee2e2; }

    .dash-sub { color: var(--cms-muted); font-size: 0.9rem; margin-top: 6px; }
    .dash-actions { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .small { font-size:0.86rem; color: var(--cms-muted); }

    .grid { display:grid; grid-template-columns: repeat(12, 1fr); gap: 14px; margin-top: 14px; }
    .kpi { grid-column: span 3; padding: 16px; }
    .panel { grid-column: span 12; padding: 16px; }

    @media (max-width: 980px) { .kpi { grid-column: span 6; } }
    @media (max-width: 620px) { .kpi { grid-column: span 12; } }

    .kpi h3 { margin:0 0 6px; font-size: 0.95rem; color: var(--cms-muted); font-weight: 600; }
    .kpi .big { font-size: 1.7rem; font-weight: 800; color: var(--cms-text); }
    .kpi .hint { margin-top:6px; font-size:0.82rem; color: var(--cms-muted); }

    .row { display:flex; gap:14px; flex-wrap:wrap; align-items:stretch; }
    .col { flex:1; min-width: 280px; }

    .chart-wrap { background:#fff; border:1px solid var(--cms-border); border-radius: 14px; padding: 12px; }
    .chart-head { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom: 6px; }
    .chart-title { font-weight: 700; color: var(--cms-navy); }
    canvas { width:100%; height: 260px; display:block; }

    .table { width:100%; border-collapse: collapse; }
    .table th, .table td { padding: 10px 10px; border-bottom: 1px solid var(--cms-border); text-align:left; font-size:0.92rem; }
    .table th { color: var(--cms-muted); font-weight:700; font-size:0.82rem; text-transform:uppercase; letter-spacing:0.06em; }
    .pill { display:inline-flex; padding:4px 10px; border-radius:999px; border:1px solid var(--cms-border); font-size:0.82rem; background:#fff; }
    .pill.ok { border-color:#16a34a; color:#166534; background:#dcfce7; }
    .pill.bad { border-color:#ef4444; color:#7f1d1d; background:#fee2e2; }

    .notice { border:1px solid var(--cms-border); background:#fff; border-radius:14px; padding:12px; }
    .notice.warn { border-color:#f59e0b; background:#fffbeb; }
    .notice.bad { border-color:#ef4444; background:#fff1f2; }
    .notice.ok { border-color:#16a34a; background:#f0fdf4; }

    .toplinks { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .link-btn { text-decoration:none; }
  </style>
</head>

<body>
  <!-- HEADER (reuse your app header style) -->
  <header class="cms-header">
    <div class="cms-header-inner">
      <div class="left-header">
        <img src="cms-logo.png" class="cms-logo" alt="Central Montessori School logo" />
        <div class="cms-title-block">
          <h1>Admin Dashboard</h1>
          <p class="cms-subtitle">Usage, performance & alerts</p>
        </div>
      </div>

      <div class="header-actions">
        <div class="toplinks">
          <a class="secondary-btn link-btn" href="index.html">Back to Chat</a>
          <a class="secondary-btn link-btn" href="logs.html">Logs</a>
          <button id="refresh-btn" class="primary-btn" type="button">Refresh</button>
        </div>
      </div>
    </div>
  </header>

  <main class="dash-wrap">

    <div class="dash-header">
      <div class="dash-title">
        <h2 style="margin:0; color:var(--cms-navy);">Dashboard</h2>
        <span id="badge" class="badge ok">OK</span>
      </div>

      <div class="dash-actions">
        <div class="small">Last refresh: <b id="last-refresh">—</b></div>
        <div class="small">Auto-refresh: <b id="auto-refresh-state">ON</b> (every 5 min, only when tab active)</div>
      </div>
    </div>

    <p class="dash-sub" id="status-line">Loading…</p>

    <div id="predictive-box" class="notice ok" style="margin-top:12px;">
      <b>Predictive alert:</b> <span id="predictive-text">—</span>
    </div>

    <section class="grid">
      <div class="card kpi">
        <h3>Total (latest window)</h3>
        <div class="big" id="kpi-total">—</div>
        <div class="hint">From /admin/stats</div>
      </div>

      <div class="card kpi">
        <h3>OK</h3>
        <div class="big" id="kpi-ok">—</div>
        <div class="hint">Successful answers</div>
      </div>

      <div class="card kpi">
        <h3>BAD</h3>
        <div class="big" id="kpi-bad">—</div>
        <div class="hint">Errors / failures</div>
      </div>

      <div class="card kpi">
        <h3>Avg response (ms)</h3>
        <div class="big" id="kpi-avgms">—</div>
        <div class="hint">Average latency</div>
      </div>

      <div class="card panel">
        <div class="row">
          <div class="col">
            <div class="chart-wrap">
              <div class="chart-head">
                <div class="chart-title">Requests by Campus (last N logs)</div>
                <div class="small">Hover bars for tooltip</div>
              </div>
              <canvas id="campusChart" width="900" height="320"></canvas>
            </div>
          </div>

          <div class="col">
            <div class="chart-wrap">
              <div class="chart-head">
                <div class="chart-title">Error rate trend (rolling)</div>
                <div class="small">Tooltip enabled</div>
              </div>
              <canvas id="trendChart" width="900" height="320"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="card panel">
        <h3 style="margin:0 0 10px; color:var(--cms-navy);">Most asked topics (quick buckets)</h3>
        <table class="table">
          <thead>
            <tr>
              <th>Topic</th>
              <th>Count</th>
              <th>Share</th>
            </tr>
          </thead>
          <tbody id="topics-body"></tbody>
        </table>
      </div>

      <div class="card panel">
        <h3 style="margin:0 0 10px; color:var(--cms-navy);">Handbooks usage (which handbook / section)</h3>
        <p class="small" style="margin-top:6px;">
          This becomes very accurate when logs include <code>handbook_id</code> and <code>section_key</code>.
        </p>
        <table class="table">
          <thead>
            <tr>
              <th>Campus</th>
              <th>Handbook</th>
              <th>Section</th>
              <th>Count</th>
            </tr>
          </thead>
          <tbody id="handbooks-body"></tbody>
        </table>
      </div>

      <div class="card panel">
        <h3 style="margin:0 0 10px; color:var(--cms-navy);">Campus breakdown</h3>
        <table class="table">
          <thead>
            <tr>
              <th>Campus</th>
              <th>Total</th>
              <th>OK</th>
              <th>BAD</th>
              <th>OK Rate</th>
            </tr>
          </thead>
          <tbody id="campus-body"></tbody>
        </table>
      </div>
    </section>

  </main>

  <footer class="cms-footer">© CMS – Admin dashboard</footer>

  <script src="dashboard.js"></script>
</body>
</html>